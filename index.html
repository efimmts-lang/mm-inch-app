<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MM ↔ INCH</title>77

<style>
body {
  font-family: Arial;
  background: #111;
  color: white;
  text-align: center;
  padding: 30px;
}

input {
  padding: 10px;
  font-size: 18px;
  width: 80%;
  margin: 10px;
}

button {
  padding: 10px 20px;
  font-size: 18px;
  margin: 10px;
  cursor: pointer;
}

.result {
  margin-top: 20px;
  font-size: 20px;
  white-space: pre-line;
}
</style>
</head>

<body>

<h2>MM ↔ INCH Converter</h2>

<input id="value" placeholder="Enter value">
<br>

<button onclick="mmToInch()">MM → Inch</button>
<button onclick="inchToMm()">Inch → MM</button>

<div class="result" id="result"></div>

<script>
const INCH_IN_MM = 25.4;
const DENOM_MAX = 64;

function gcd(a,b){
  a=Math.abs(a); b=Math.abs(b);
  while(b){ [a,b]=[b,a%b]; }
  return a||1;
}

function toMixedFraction(x, denomMax = DENOM_MAX){
  if (!isFinite(x)) return "";
  const sign = x < 0 ? "-" : "";
  x = Math.abs(x);

  const whole = Math.floor(x);
  const frac = x - whole;

  if (frac < 1e-12) return `${sign}${whole}`;

  let bestNum = 0, bestDen = 1, bestErr = Infinity;
  for (let den = 2; den <= denomMax; den++){
    const num = Math.round(frac * den);
    const err = Math.abs(frac - (num/den));
    if (err < bestErr){ bestErr = err; bestNum = num; bestDen = den; }
  }

  const g = gcd(bestNum, bestDen);
  let num = bestNum / g;
  let den = bestDen / g;

  let w = whole;
  if (num === den){ w += 1; num = 0; den = 1; }

  if (num === 0) return `${sign}${w}`;
  if (w === 0) return `${sign}${num}/${den}`;
  return `${sign}${w} ${num}/${den}`;
}

// --- парсер дюймовых строк ---
// Понимает: 1.25, 3/8, 1 3/8, 1-3/8, 2", 2 1/2",  -1-3/8
function parseInchInput(s){
  if (!s) return NaN;
  s = String(s).trim().toLowerCase();

  // убрать кавычки дюйма и лишние пробелы
  s = s.replace(/"/g, "").replace(/\s+/g, " ");

  // заменить дефис между целой и дробной частью на пробел: 1-3/8 -> 1 3/8
  s = s.replace(/^(-?\d+)\s*-\s*(\d+)\s*\/\s*(\d+)$/i, "$1 $2/$3");

  // если просто число
  if (/^-?\d+(\.\d+)?$/.test(s)) return parseFloat(s);

  // если чистая дробь a/b
  if (/^-?\d+\s*\/\s*\d+$/.test(s)){
    const neg = s.startsWith("-");
    const parts = s.replace("-", "").split("/");
    const a = parseInt(parts[0].trim(),10);
    const b = parseInt(parts[1].trim(),10);
    if (!b) return NaN;
    return (neg ? -1 : 1) * (a / b);
  }

  // смешанная: w a/b
  const m = s.match(/^(-?\d+)\s+(\d+)\s*\/\s*(\d+)$/);
  if (m){
    const w = parseInt(m[1],10);
    const a = parseInt(m[2],10);
    const b = parseInt(m[3],10);
    if (!b) return NaN;
    const sign = w < 0 ? -1 : 1;
    return w + sign * (a / b);
  }

  return NaN;
}

function mmToInch() {
  let v = parseFloat(document.getElementById("value").value);
  if (isNaN(v)) {
    document.getElementById("result").innerText = "Enter a number in mm.";
    return;
  }
  let inch = v / INCH_IN_MM;
  let frac = toMixedFraction(inch);
  document.getElementById("result").innerText =
    `${v} mm = ${inch.toFixed(5)} inch\n≈ ${frac}" (up to 1/64)`;
}

function inchToMm() {
  const raw = document.getElementById("value").value;
  let inch = parseInchInput(raw);

  if (isNaN(inch)) {
    document.getElementById("result").innerText =
      `Enter inches like: 1.25, 3/8, 1 3/8, 1-3/8, 2"`;
    return;
  }

  let mm = inch * INCH_IN_MM;
  document.getElementById("result").innerText =
    `${raw} inch = ${mm.toFixed(3)} mm`;
}
</script>

</body>
</html>
